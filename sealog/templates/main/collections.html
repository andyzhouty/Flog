{% extends 'base.html' %}
{% block page_content %}
    <ul class="list-group">
        {% for post in posts %}
        <li class="list-group-item">
        <h3 class="text-primary">{{ post.title }}</h3>
        <div>
            {{ post.content | striptags | truncate(200) }}
            <small class="text-primary">
                <a href="{{ url_for('main.full_post', slug=post.slug) }}">Read More</a>
            </small>
            {% if current_user.is_authenticated %}
                <div>
                    {% if not current_user.is_collecting(post) %}
                    <a class="btn btn-sm btn-success" href="{{ url_for('main.collect_post', id=post.id) }}">
                        Collect
                    </a>
                    {% else %}
                    <a class="btn btn-sm btn-warning" href="{{ url_for('main.uncollect_post', id=post.id) }}">
                        Uncollect
                    </a>
                    {% endif %}
                    {% if current_user.is_administrator() or post.author == current_user %}
                        <a class="btn btn-sm btn-primary" href="{{ url_for('main.edit_post', id=post.id) }}">
                            EDIT [ADMIN]
                        </a>
                    {% endif %}
                    {# 如果当前用户是协管员，并且文章作者没有协管员权限时，抑或当前用户是该文章作者时，显示删除按钮 #}
                    {% if (current_user.can(Permission.MODERATE)  and not post.author.can(Permission.MODERATE))
                        or current_user.is_administrator() or post.author == current_user %}
                        <form class="inline" method="POST" action="{{ url_for('main.delete_post', id=post.id)}}"
                            style="display: inline !important">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                            <button class="btn btn-sm btn-danger" onclick="return confirm('Are you sure?');">
                                DELETE [ADMIN]
                            </button>
                        </form>
                    {% endif %}
                </div>
            {% endif %}
        </div>
    </li>
        {% endfor %}
    </ul>
{% endblock page_content %}